"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _typeof = require("@babel/runtime/helpers/typeof");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DEFAULT_STATE = void 0;

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _URLManager = _interopRequireDefault(require("./URLManager"));

var _RequestSequencer = _interopRequireDefault(require("./RequestSequencer"));

var _DebounceManager = _interopRequireDefault(require("./DebounceManager"));

var actions = _interopRequireWildcard(require("./actions"));

var _Events = _interopRequireDefault(require("./Events"));

var _helpers = require("./helpers");

var a11y = _interopRequireWildcard(require("./A11yNotifications"));

var _excluded = ["filters", "conditionalFacets"];

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function filterSearchParameters(_ref) {
  var current = _ref.current,
      filters = _ref.filters,
      resultsPerPage = _ref.resultsPerPage,
      searchTerm = _ref.searchTerm,
      sortDirection = _ref.sortDirection,
      sortField = _ref.sortField,
      sortList = _ref.sortList;
  return {
    current: current,
    filters: filters,
    resultsPerPage: resultsPerPage,
    searchTerm: searchTerm,
    sortDirection: sortDirection,
    sortField: sortField,
    sortList: sortList
  };
}

var DEFAULT_STATE = {
  // Search Parameters -- This is state that represents the input state.
  current: 1,
  filters: [],
  resultsPerPage: 20,
  searchTerm: "",
  sortDirection: "",
  sortField: "",
  sortList: [],
  // Result State -- This state represents state that is updated automatically
  // as the result of changing input state.
  autocompletedResults: [],
  autocompletedResultsRequestId: "",
  autocompletedSuggestions: {},
  autocompletedSuggestionsRequestId: "",
  error: "",
  isLoading: false,
  facets: {},
  requestId: "",
  results: [],
  resultSearchTerm: "",
  totalPages: 0,
  totalResults: 0,
  pagingStart: 0,
  pagingEnd: 0,
  wasSearched: false,
  rawResponse: {}
};
exports.DEFAULT_STATE = DEFAULT_STATE;

function removeConditionalFacets() {
  var facets = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var conditionalFacets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var filters = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];
  return Object.entries(facets).reduce(function (acc, _ref2) {
    var _ref3 = (0, _slicedToArray2.default)(_ref2, 2),
        facetKey = _ref3[0],
        facet = _ref3[1];

    if (conditionalFacets[facetKey] && typeof conditionalFacets[facetKey] === "function" && !conditionalFacets[facetKey]({
      filters: filters
    })) {
      return acc;
    }

    acc[facetKey] = facet;
    return acc;
  }, {});
}
/*
 * The Driver is a framework agnostic search state manager that is capable
 * syncing state to the url.
 */


var SearchDriver = /*#__PURE__*/function () {
  function SearchDriver(_ref4) {
    var _this = this;

    var apiConnector = _ref4.apiConnector,
        _ref4$autocompleteQue = _ref4.autocompleteQuery,
        autocompleteQuery = _ref4$autocompleteQue === void 0 ? {} : _ref4$autocompleteQue,
        debug = _ref4.debug,
        initialState = _ref4.initialState,
        onSearch = _ref4.onSearch,
        onAutocomplete = _ref4.onAutocomplete,
        onResultClick = _ref4.onResultClick,
        onAutocompleteResultClick = _ref4.onAutocompleteResultClick,
        _ref4$searchQuery = _ref4.searchQuery,
        searchQuery = _ref4$searchQuery === void 0 ? {} : _ref4$searchQuery,
        _ref4$trackUrlState = _ref4.trackUrlState,
        trackUrlState = _ref4$trackUrlState === void 0 ? true : _ref4$trackUrlState,
        _ref4$urlPushDebounce = _ref4.urlPushDebounceLength,
        urlPushDebounceLength = _ref4$urlPushDebounce === void 0 ? 500 : _ref4$urlPushDebounce,
        _ref4$hasA11yNotifica = _ref4.hasA11yNotifications,
        hasA11yNotifications = _ref4$hasA11yNotifica === void 0 ? false : _ref4$hasA11yNotifica,
        _ref4$a11yNotificatio = _ref4.a11yNotificationMessages,
        a11yNotificationMessages = _ref4$a11yNotificatio === void 0 ? {} : _ref4$a11yNotificatio,
        _ref4$alwaysSearchOnI = _ref4.alwaysSearchOnInitialLoad,
        alwaysSearchOnInitialLoad = _ref4$alwaysSearchOnI === void 0 ? false : _ref4$alwaysSearchOnI;
    (0, _classCallCheck2.default)(this, SearchDriver);
    (0, _defineProperty2.default)(this, "state", DEFAULT_STATE);
    (0, _defineProperty2.default)(this, "_updateAutocomplete", function (searchTerm) {
      var _ref5 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          autocompleteResults = _ref5.autocompleteResults,
          autocompleteSuggestions = _ref5.autocompleteSuggestions;

      var requestId = _this.autocompleteRequestSequencer.next();

      var queryConfig = _objectSpread(_objectSpread({}, autocompleteResults && {
        results: _this.autocompleteQuery.results || {}
      }), autocompleteSuggestions && {
        suggestions: _this.autocompleteQuery.suggestions || {}
      });

      return _this.events.autocomplete({
        searchTerm: searchTerm
      }, queryConfig).then(function (autocompleted) {
        if (_this.autocompleteRequestSequencer.isOldRequest(requestId)) return;

        _this.autocompleteRequestSequencer.completed(requestId);

        _this._setState(autocompleted);
      });
    });
    (0, _defineProperty2.default)(this, "_updateSearchResults", function (searchParameters) {
      var _ref6 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
          _ref6$skipPushToUrl = _ref6.skipPushToUrl,
          skipPushToUrl = _ref6$skipPushToUrl === void 0 ? false : _ref6$skipPushToUrl,
          _ref6$replaceUrl = _ref6.replaceUrl,
          replaceUrl = _ref6$replaceUrl === void 0 ? false : _ref6$replaceUrl;

      var _this$state$searchPar = _objectSpread(_objectSpread({}, _this.state), searchParameters),
          current = _this$state$searchPar.current,
          filters = _this$state$searchPar.filters,
          resultsPerPage = _this$state$searchPar.resultsPerPage,
          searchTerm = _this$state$searchPar.searchTerm,
          sortDirection = _this$state$searchPar.sortDirection,
          sortField = _this$state$searchPar.sortField,
          sortList = _this$state$searchPar.sortList; // State updates should always be applied in the order that they are made. This function, _updateSearchResults,
      // makes state updates.
      // In the case where a call to "_updateSearchResults" was made and delayed for X amount of time using
      // `debounceManager.runWithDebounce`, and a subsequent call is made _updateSearchResults before that delay ends, we
      // want to make sure that outstanding call to "_updateSearchResults" is cancelled, as it would apply state updates
      // out of order.


      _this.debounceManager.cancelByName("_updateSearchResults");

      _this._setState({
        current: current,
        error: "",
        filters: filters,
        resultsPerPage: resultsPerPage,
        searchTerm: searchTerm,
        sortDirection: sortDirection,
        sortField: sortField,
        sortList: sortList
      });

      _this._makeSearchRequest({
        skipPushToUrl: skipPushToUrl,
        replaceUrl: replaceUrl
      });
    });
    (0, _defineProperty2.default)(this, "_makeSearchRequest", _DebounceManager.default.debounce(0, function (_ref7) {
      var skipPushToUrl = _ref7.skipPushToUrl,
          replaceUrl = _ref7.replaceUrl;
      var _this$state = _this.state,
          current = _this$state.current,
          filters = _this$state.filters,
          resultsPerPage = _this$state.resultsPerPage,
          searchTerm = _this$state.searchTerm,
          sortDirection = _this$state.sortDirection,
          sortField = _this$state.sortField,
          sortList = _this$state.sortList;

      _this._setState({
        isLoading: true
      });

      var requestId = _this.searchRequestSequencer.next();

      var _this$searchQuery = _this.searchQuery,
          searchQueryFilters = _this$searchQuery.filters,
          conditionalFacets = _this$searchQuery.conditionalFacets,
          restOfSearchQuery = (0, _objectWithoutProperties2.default)(_this$searchQuery, _excluded);

      var queryConfig = _objectSpread(_objectSpread({}, restOfSearchQuery), {}, {
        facets: removeConditionalFacets(_this.searchQuery.facets, conditionalFacets, filters)
      });

      var requestState = _objectSpread(_objectSpread({}, filterSearchParameters(_this.state)), {}, {
        filters: (0, _helpers.mergeFilters)(filters, _this.searchQuery.filters)
      });

      return _this.events.search(requestState, queryConfig).then(function (resultState) {
        if (_this.searchRequestSequencer.isOldRequest(requestId)) return;

        _this.searchRequestSequencer.completed(requestId); // Results paging start & end


        var totalResults = resultState.totalResults;
        var start = totalResults === 0 ? 0 : (current - 1) * resultsPerPage + 1;
        var end = totalResults <= start + resultsPerPage ? totalResults : start + resultsPerPage - 1;

        _this._setState(_objectSpread(_objectSpread({
          isLoading: false,
          resultSearchTerm: searchTerm,
          pagingStart: start,
          pagingEnd: end
        }, resultState), {}, {
          wasSearched: true
        }));

        if (_this.hasA11yNotifications) {
          var messageArgs = {
            start: start,
            end: end,
            totalResults: totalResults,
            searchTerm: searchTerm
          };

          _this.actions.a11yNotify("searchResults", messageArgs);
        }

        if (!skipPushToUrl && _this.trackUrlState) {
          // We debounce here so that we don't get a lot of intermediary
          // URL state if someone is updating a UI really fast, like typing
          // in a live search box for instance.
          _this.debounceManager.runWithDebounce(_this.urlPushDebounceLength, "pushStateToURL", _this.URLManager.pushStateToURL.bind(_this.URLManager), {
            current: current,
            filters: filters,
            resultsPerPage: resultsPerPage,
            searchTerm: searchTerm,
            sortDirection: sortDirection,
            sortField: sortField,
            sortList: sortList
          }, {
            replaceUrl: replaceUrl
          });
        }
      }, function (error) {
        _this._setState({
          error: "An unexpected error occurred: ".concat(error.message)
        });
      });
    }));
    this.actions = Object.entries(actions).reduce(function (acc, _ref8) {
      var _ref9 = (0, _slicedToArray2.default)(_ref8, 2),
          actionName = _ref9[0],
          action = _ref9[1];

      return _objectSpread(_objectSpread({}, acc), {}, (0, _defineProperty2.default)({}, actionName, action.bind(_this)));
    }, {});
    Object.assign(this, this.actions);
    this.events = new _Events.default({
      apiConnector: apiConnector,
      onSearch: onSearch,
      onAutocomplete: onAutocomplete,
      onResultClick: onResultClick,
      onAutocompleteResultClick: onAutocompleteResultClick
    });
    this.debug = debug;

    if (this.debug) {
      console.warn("Search UI Debugging is enabled. This should be turned off in production deployments.");
      window.searchUI = this;
    }

    this.autocompleteRequestSequencer = new _RequestSequencer.default();
    this.searchRequestSequencer = new _RequestSequencer.default();
    this.debounceManager = new _DebounceManager.default();
    this.autocompleteQuery = autocompleteQuery;
    this.searchQuery = searchQuery;
    this.subscriptions = [];
    this.trackUrlState = trackUrlState;
    this.urlPushDebounceLength = urlPushDebounceLength;
    this.alwaysSearchOnInitialLoad = alwaysSearchOnInitialLoad;
    var urlState;

    if (trackUrlState) {
      this.URLManager = new _URLManager.default();
      urlState = this.URLManager.getStateFromURL();
      this.URLManager.onURLStateChange(function (urlState) {
        _this._updateSearchResults(_objectSpread(_objectSpread({}, DEFAULT_STATE), urlState), {
          skipPushToUrl: true
        });
      });
    } else {
      urlState = {};
    } // Manage screen reader accessible notifications


    this.hasA11yNotifications = hasA11yNotifications;
    if (this.hasA11yNotifications) a11y.getLiveRegion();
    this.a11yNotificationMessages = _objectSpread(_objectSpread({}, a11y.defaultMessages), a11yNotificationMessages); // Remember the state this application is initialized into, so that we can
    // reset to it later.

    this.startingState = _objectSpread(_objectSpread({}, this.state), initialState); // We filter these here to disallow anything other than valid search
    // parameters to be passed in initial state, or url state. `results`, etc,
    // should not be allowed to be passed in, that should be generated based on
    // the results of the query

    var _searchParameters = filterSearchParameters(_objectSpread(_objectSpread({}, this.startingState), urlState)); // Initialize the state without calling _setState, because we don't
    // want to trigger an update callback, we're just initializing the state
    // to the correct default values for the initial UI render


    this.state = _objectSpread(_objectSpread({}, this.state), _searchParameters); // We'll trigger an initial search if initial parameters contain
    // a search term or filters, or if alwaysSearchOnInitialLoad is set.
    // Otherwise, we'll just save their selections in state as initial values.

    if (_searchParameters.searchTerm || _searchParameters.filters.length > 0 || this.alwaysSearchOnInitialLoad) {
      this._updateSearchResults(_searchParameters, {
        replaceUrl: true
      });
    }
  }
  /**
   * This method is used to update state and trigger a new autocomplete search.
   *
   * @param {string} searchTerm
   * @param {Object=} Object
   * @param {boolean|Object} options.autocompleteResults - Should autocomplete results
   * @param {boolean|Object} options.autocompleteSuggestions - Should autocomplete suggestions
   */


  (0, _createClass2.default)(SearchDriver, [{
    key: "_setState",
    value: function _setState(newState) {
      var state = _objectSpread(_objectSpread({}, this.state), newState); // eslint-disable-next-line no-console


      if (this.debug) console.log("Search UI: State Update", newState, state);
      this.state = state;
      this.subscriptions.forEach(function (subscription) {
        return subscription(state);
      });
    }
    /**
     * Dynamically update the searchQuery configuration in this driver.
     * This will issue a new query after being updated.
     *
     * @param Object searchQuery
     */

  }, {
    key: "setSearchQuery",
    value: function setSearchQuery(searchQuery) {
      this.searchQuery = searchQuery;

      this._updateSearchResults();
    }
    /**
     * @param Object autocompleteQuery
     */

  }, {
    key: "setAutocompleteQuery",
    value: function setAutocompleteQuery(autocompleteQuery) {
      this.autocompleteQuery = autocompleteQuery;
    }
    /**
     * Any time state is updated in this Driver, the provided callback
     * will be executed with the updated state.
     *
     * @param onStateChange Function
     */

  }, {
    key: "subscribeToStateChanges",
    value: function subscribeToStateChanges(onStateChange) {
      this.subscriptions.push(onStateChange);
    }
    /**
     * @param onStateChange Function
     */

  }, {
    key: "unsubscribeToStateChanges",
    value: function unsubscribeToStateChanges(onStateChange) {
      this.subscriptions = this.subscriptions.filter(function (sub) {
        return sub !== onStateChange;
      });
    }
    /**
     * Remove all listeners
     */

  }, {
    key: "tearDown",
    value: function tearDown() {
      this.subscriptions = [];
      this.URLManager && this.URLManager.tearDown();
    }
    /**
     * Retrieves all available acitons
     *
     * @returns Object All actions
     */

  }, {
    key: "getActions",
    value: function getActions() {
      return this.actions;
    }
    /**
     * Retrieve current state. Typically used on app initialization. Subsequent
     * state updates should come through subscription.
     *
     * @returns Object Current state
     */

  }, {
    key: "getState",
    value: function getState() {
      // We return a copy of state here, because we want to ensure the state
      // inside of this object remains immutable.
      return _objectSpread({}, this.state);
    }
  }]);
  return SearchDriver;
}();

exports.default = SearchDriver;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TZWFyY2hEcml2ZXIuanMiXSwibmFtZXMiOlsiZmlsdGVyU2VhcmNoUGFyYW1ldGVycyIsImN1cnJlbnQiLCJmaWx0ZXJzIiwicmVzdWx0c1BlclBhZ2UiLCJzZWFyY2hUZXJtIiwic29ydERpcmVjdGlvbiIsInNvcnRGaWVsZCIsInNvcnRMaXN0IiwiREVGQVVMVF9TVEFURSIsImF1dG9jb21wbGV0ZWRSZXN1bHRzIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHNSZXF1ZXN0SWQiLCJhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnMiLCJhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnNSZXF1ZXN0SWQiLCJlcnJvciIsImlzTG9hZGluZyIsImZhY2V0cyIsInJlcXVlc3RJZCIsInJlc3VsdHMiLCJyZXN1bHRTZWFyY2hUZXJtIiwidG90YWxQYWdlcyIsInRvdGFsUmVzdWx0cyIsInBhZ2luZ1N0YXJ0IiwicGFnaW5nRW5kIiwid2FzU2VhcmNoZWQiLCJyYXdSZXNwb25zZSIsInJlbW92ZUNvbmRpdGlvbmFsRmFjZXRzIiwiY29uZGl0aW9uYWxGYWNldHMiLCJPYmplY3QiLCJlbnRyaWVzIiwicmVkdWNlIiwiYWNjIiwiZmFjZXRLZXkiLCJmYWNldCIsIlNlYXJjaERyaXZlciIsImFwaUNvbm5lY3RvciIsImF1dG9jb21wbGV0ZVF1ZXJ5IiwiZGVidWciLCJpbml0aWFsU3RhdGUiLCJvblNlYXJjaCIsIm9uQXV0b2NvbXBsZXRlIiwib25SZXN1bHRDbGljayIsIm9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2siLCJzZWFyY2hRdWVyeSIsInRyYWNrVXJsU3RhdGUiLCJ1cmxQdXNoRGVib3VuY2VMZW5ndGgiLCJoYXNBMTF5Tm90aWZpY2F0aW9ucyIsImExMXlOb3RpZmljYXRpb25NZXNzYWdlcyIsImFsd2F5c1NlYXJjaE9uSW5pdGlhbExvYWQiLCJhdXRvY29tcGxldGVSZXN1bHRzIiwiYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMiLCJhdXRvY29tcGxldGVSZXF1ZXN0U2VxdWVuY2VyIiwibmV4dCIsInF1ZXJ5Q29uZmlnIiwic3VnZ2VzdGlvbnMiLCJldmVudHMiLCJhdXRvY29tcGxldGUiLCJ0aGVuIiwiYXV0b2NvbXBsZXRlZCIsImlzT2xkUmVxdWVzdCIsImNvbXBsZXRlZCIsIl9zZXRTdGF0ZSIsInNlYXJjaFBhcmFtZXRlcnMiLCJza2lwUHVzaFRvVXJsIiwicmVwbGFjZVVybCIsInN0YXRlIiwiZGVib3VuY2VNYW5hZ2VyIiwiY2FuY2VsQnlOYW1lIiwiX21ha2VTZWFyY2hSZXF1ZXN0IiwiRGVib3VuY2VNYW5hZ2VyIiwiZGVib3VuY2UiLCJzZWFyY2hSZXF1ZXN0U2VxdWVuY2VyIiwic2VhcmNoUXVlcnlGaWx0ZXJzIiwicmVzdE9mU2VhcmNoUXVlcnkiLCJyZXF1ZXN0U3RhdGUiLCJzZWFyY2giLCJyZXN1bHRTdGF0ZSIsInN0YXJ0IiwiZW5kIiwibWVzc2FnZUFyZ3MiLCJhY3Rpb25zIiwiYTExeU5vdGlmeSIsInJ1bldpdGhEZWJvdW5jZSIsIlVSTE1hbmFnZXIiLCJwdXNoU3RhdGVUb1VSTCIsImJpbmQiLCJtZXNzYWdlIiwiYWN0aW9uTmFtZSIsImFjdGlvbiIsImFzc2lnbiIsIkV2ZW50cyIsImNvbnNvbGUiLCJ3YXJuIiwid2luZG93Iiwic2VhcmNoVUkiLCJSZXF1ZXN0U2VxdWVuY2VyIiwic3Vic2NyaXB0aW9ucyIsInVybFN0YXRlIiwiZ2V0U3RhdGVGcm9tVVJMIiwib25VUkxTdGF0ZUNoYW5nZSIsIl91cGRhdGVTZWFyY2hSZXN1bHRzIiwiYTExeSIsImdldExpdmVSZWdpb24iLCJkZWZhdWx0TWVzc2FnZXMiLCJzdGFydGluZ1N0YXRlIiwibGVuZ3RoIiwibmV3U3RhdGUiLCJsb2ciLCJmb3JFYWNoIiwic3Vic2NyaXB0aW9uIiwib25TdGF0ZUNoYW5nZSIsInB1c2giLCJmaWx0ZXIiLCJzdWIiLCJ0ZWFyRG93biJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FB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O0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7OztXQUNFLHNCQUFhO0FBQ1gsYUFBTyxLQUFLbEMsT0FBWjtBQUNEO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O1dBQ0Usb0JBQVc7QUFDVDtBQUNBO0FBQ0EsK0JBQVksS0FBS2YsS0FBakI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBVUkxNYW5hZ2VyIGZyb20gXCIuL1VSTE1hbmFnZXJcIjtcblxuaW1wb3J0IFJlcXVlc3RTZXF1ZW5jZXIgZnJvbSBcIi4vUmVxdWVzdFNlcXVlbmNlclwiO1xuaW1wb3J0IERlYm91bmNlTWFuYWdlciBmcm9tIFwiLi9EZWJvdW5jZU1hbmFnZXJcIjtcblxuaW1wb3J0ICogYXMgYWN0aW9ucyBmcm9tIFwiLi9hY3Rpb25zXCI7XG5pbXBvcnQgRXZlbnRzIGZyb20gXCIuL0V2ZW50c1wiO1xuaW1wb3J0IHsgbWVyZ2VGaWx0ZXJzIH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuXG5pbXBvcnQgKiBhcyBhMTF5IGZyb20gXCIuL0ExMXlOb3RpZmljYXRpb25zXCI7XG5cbmZ1bmN0aW9uIGZpbHRlclNlYXJjaFBhcmFtZXRlcnMoe1xuICBjdXJyZW50LFxuICBmaWx0ZXJzLFxuICByZXN1bHRzUGVyUGFnZSxcbiAgc2VhcmNoVGVybSxcbiAgc29ydERpcmVjdGlvbixcbiAgc29ydEZpZWxkLFxuICBzb3J0TGlzdFxufSkge1xuICByZXR1cm4ge1xuICAgIGN1cnJlbnQsXG4gICAgZmlsdGVycyxcbiAgICByZXN1bHRzUGVyUGFnZSxcbiAgICBzZWFyY2hUZXJtLFxuICAgIHNvcnREaXJlY3Rpb24sXG4gICAgc29ydEZpZWxkLFxuICAgIHNvcnRMaXN0XG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NUQVRFID0ge1xuICAvLyBTZWFyY2ggUGFyYW1ldGVycyAtLSBUaGlzIGlzIHN0YXRlIHRoYXQgcmVwcmVzZW50cyB0aGUgaW5wdXQgc3RhdGUuXG4gIGN1cnJlbnQ6IDEsXG4gIGZpbHRlcnM6IFtdLFxuICByZXN1bHRzUGVyUGFnZTogMjAsXG4gIHNlYXJjaFRlcm06IFwiXCIsXG4gIHNvcnREaXJlY3Rpb246IFwiXCIsXG4gIHNvcnRGaWVsZDogXCJcIixcbiAgc29ydExpc3Q6IFtdLFxuICAvLyBSZXN1bHQgU3RhdGUgLS0gVGhpcyBzdGF0ZSByZXByZXNlbnRzIHN0YXRlIHRoYXQgaXMgdXBkYXRlZCBhdXRvbWF0aWNhbGx5XG4gIC8vIGFzIHRoZSByZXN1bHQgb2YgY2hhbmdpbmcgaW5wdXQgc3RhdGUuXG4gIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBbXSxcbiAgYXV0b2NvbXBsZXRlZFJlc3VsdHNSZXF1ZXN0SWQ6IFwiXCIsXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uczoge30sXG4gIGF1dG9jb21wbGV0ZWRTdWdnZXN0aW9uc1JlcXVlc3RJZDogXCJcIixcbiAgZXJyb3I6IFwiXCIsXG4gIGlzTG9hZGluZzogZmFsc2UsXG4gIGZhY2V0czoge30sXG4gIHJlcXVlc3RJZDogXCJcIixcbiAgcmVzdWx0czogW10sXG4gIHJlc3VsdFNlYXJjaFRlcm06IFwiXCIsXG4gIHRvdGFsUGFnZXM6IDAsXG4gIHRvdGFsUmVzdWx0czogMCxcbiAgcGFnaW5nU3RhcnQ6IDAsXG4gIHBhZ2luZ0VuZDogMCxcbiAgd2FzU2VhcmNoZWQ6IGZhbHNlLFxuICByYXdSZXNwb25zZToge31cbn07XG5cbmZ1bmN0aW9uIHJlbW92ZUNvbmRpdGlvbmFsRmFjZXRzKFxuICBmYWNldHMgPSB7fSxcbiAgY29uZGl0aW9uYWxGYWNldHMgPSB7fSxcbiAgZmlsdGVycyA9IFtdXG4pIHtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGZhY2V0cykucmVkdWNlKChhY2MsIFtmYWNldEtleSwgZmFjZXRdKSA9PiB7XG4gICAgaWYgKFxuICAgICAgY29uZGl0aW9uYWxGYWNldHNbZmFjZXRLZXldICYmXG4gICAgICB0eXBlb2YgY29uZGl0aW9uYWxGYWNldHNbZmFjZXRLZXldID09PSBcImZ1bmN0aW9uXCIgJiZcbiAgICAgICFjb25kaXRpb25hbEZhY2V0c1tmYWNldEtleV0oeyBmaWx0ZXJzIH0pXG4gICAgKSB7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGFjY1tmYWNldEtleV0gPSBmYWNldDtcbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59XG5cbi8qXG4gKiBUaGUgRHJpdmVyIGlzIGEgZnJhbWV3b3JrIGFnbm9zdGljIHNlYXJjaCBzdGF0ZSBtYW5hZ2VyIHRoYXQgaXMgY2FwYWJsZVxuICogc3luY2luZyBzdGF0ZSB0byB0aGUgdXJsLlxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZWFyY2hEcml2ZXIge1xuICBzdGF0ZSA9IERFRkFVTFRfU1RBVEU7XG5cbiAgY29uc3RydWN0b3Ioe1xuICAgIGFwaUNvbm5lY3RvcixcbiAgICBhdXRvY29tcGxldGVRdWVyeSA9IHt9LFxuICAgIGRlYnVnLFxuICAgIGluaXRpYWxTdGF0ZSxcbiAgICBvblNlYXJjaCxcbiAgICBvbkF1dG9jb21wbGV0ZSxcbiAgICBvblJlc3VsdENsaWNrLFxuICAgIG9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2ssXG4gICAgc2VhcmNoUXVlcnkgPSB7fSxcbiAgICB0cmFja1VybFN0YXRlID0gdHJ1ZSxcbiAgICB1cmxQdXNoRGVib3VuY2VMZW5ndGggPSA1MDAsXG4gICAgaGFzQTExeU5vdGlmaWNhdGlvbnMgPSBmYWxzZSxcbiAgICBhMTF5Tm90aWZpY2F0aW9uTWVzc2FnZXMgPSB7fSxcbiAgICBhbHdheXNTZWFyY2hPbkluaXRpYWxMb2FkID0gZmFsc2VcbiAgfSkge1xuICAgIHRoaXMuYWN0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGFjdGlvbnMpLnJlZHVjZShcbiAgICAgIChhY2MsIFthY3Rpb25OYW1lLCBhY3Rpb25dKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgLi4uYWNjLFxuICAgICAgICAgIFthY3Rpb25OYW1lXTogYWN0aW9uLmJpbmQodGhpcylcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7fVxuICAgICk7XG4gICAgT2JqZWN0LmFzc2lnbih0aGlzLCB0aGlzLmFjdGlvbnMpO1xuXG4gICAgdGhpcy5ldmVudHMgPSBuZXcgRXZlbnRzKHtcbiAgICAgIGFwaUNvbm5lY3RvcixcbiAgICAgIG9uU2VhcmNoLFxuICAgICAgb25BdXRvY29tcGxldGUsXG4gICAgICBvblJlc3VsdENsaWNrLFxuICAgICAgb25BdXRvY29tcGxldGVSZXN1bHRDbGlja1xuICAgIH0pO1xuXG4gICAgdGhpcy5kZWJ1ZyA9IGRlYnVnO1xuICAgIGlmICh0aGlzLmRlYnVnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIFwiU2VhcmNoIFVJIERlYnVnZ2luZyBpcyBlbmFibGVkLiBUaGlzIHNob3VsZCBiZSB0dXJuZWQgb2ZmIGluIHByb2R1Y3Rpb24gZGVwbG95bWVudHMuXCJcbiAgICAgICk7XG4gICAgICB3aW5kb3cuc2VhcmNoVUkgPSB0aGlzO1xuICAgIH1cbiAgICB0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3RTZXF1ZW5jZXIgPSBuZXcgUmVxdWVzdFNlcXVlbmNlcigpO1xuICAgIHRoaXMuc2VhcmNoUmVxdWVzdFNlcXVlbmNlciA9IG5ldyBSZXF1ZXN0U2VxdWVuY2VyKCk7XG4gICAgdGhpcy5kZWJvdW5jZU1hbmFnZXIgPSBuZXcgRGVib3VuY2VNYW5hZ2VyKCk7XG4gICAgdGhpcy5hdXRvY29tcGxldGVRdWVyeSA9IGF1dG9jb21wbGV0ZVF1ZXJ5O1xuICAgIHRoaXMuc2VhcmNoUXVlcnkgPSBzZWFyY2hRdWVyeTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICB0aGlzLnRyYWNrVXJsU3RhdGUgPSB0cmFja1VybFN0YXRlO1xuICAgIHRoaXMudXJsUHVzaERlYm91bmNlTGVuZ3RoID0gdXJsUHVzaERlYm91bmNlTGVuZ3RoO1xuICAgIHRoaXMuYWx3YXlzU2VhcmNoT25Jbml0aWFsTG9hZCA9IGFsd2F5c1NlYXJjaE9uSW5pdGlhbExvYWQ7XG5cbiAgICBsZXQgdXJsU3RhdGU7XG4gICAgaWYgKHRyYWNrVXJsU3RhdGUpIHtcbiAgICAgIHRoaXMuVVJMTWFuYWdlciA9IG5ldyBVUkxNYW5hZ2VyKCk7XG4gICAgICB1cmxTdGF0ZSA9IHRoaXMuVVJMTWFuYWdlci5nZXRTdGF0ZUZyb21VUkwoKTtcbiAgICAgIHRoaXMuVVJMTWFuYWdlci5vblVSTFN0YXRlQ2hhbmdlKHVybFN0YXRlID0+IHtcbiAgICAgICAgdGhpcy5fdXBkYXRlU2VhcmNoUmVzdWx0cyhcbiAgICAgICAgICB7IC4uLkRFRkFVTFRfU1RBVEUsIC4uLnVybFN0YXRlIH0sXG4gICAgICAgICAgeyBza2lwUHVzaFRvVXJsOiB0cnVlIH1cbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cmxTdGF0ZSA9IHt9O1xuICAgIH1cblxuICAgIC8vIE1hbmFnZSBzY3JlZW4gcmVhZGVyIGFjY2Vzc2libGUgbm90aWZpY2F0aW9uc1xuICAgIHRoaXMuaGFzQTExeU5vdGlmaWNhdGlvbnMgPSBoYXNBMTF5Tm90aWZpY2F0aW9ucztcbiAgICBpZiAodGhpcy5oYXNBMTF5Tm90aWZpY2F0aW9ucykgYTExeS5nZXRMaXZlUmVnaW9uKCk7XG5cbiAgICB0aGlzLmExMXlOb3RpZmljYXRpb25NZXNzYWdlcyA9IHtcbiAgICAgIC4uLmExMXkuZGVmYXVsdE1lc3NhZ2VzLFxuICAgICAgLi4uYTExeU5vdGlmaWNhdGlvbk1lc3NhZ2VzXG4gICAgfTtcblxuICAgIC8vIFJlbWVtYmVyIHRoZSBzdGF0ZSB0aGlzIGFwcGxpY2F0aW9uIGlzIGluaXRpYWxpemVkIGludG8sIHNvIHRoYXQgd2UgY2FuXG4gICAgLy8gcmVzZXQgdG8gaXQgbGF0ZXIuXG4gICAgdGhpcy5zdGFydGluZ1N0YXRlID0ge1xuICAgICAgLi4udGhpcy5zdGF0ZSxcbiAgICAgIC4uLmluaXRpYWxTdGF0ZVxuICAgIH07XG5cbiAgICAvLyBXZSBmaWx0ZXIgdGhlc2UgaGVyZSB0byBkaXNhbGxvdyBhbnl0aGluZyBvdGhlciB0aGFuIHZhbGlkIHNlYXJjaFxuICAgIC8vIHBhcmFtZXRlcnMgdG8gYmUgcGFzc2VkIGluIGluaXRpYWwgc3RhdGUsIG9yIHVybCBzdGF0ZS4gYHJlc3VsdHNgLCBldGMsXG4gICAgLy8gc2hvdWxkIG5vdCBiZSBhbGxvd2VkIHRvIGJlIHBhc3NlZCBpbiwgdGhhdCBzaG91bGQgYmUgZ2VuZXJhdGVkIGJhc2VkIG9uXG4gICAgLy8gdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5XG4gICAgY29uc3Qgc2VhcmNoUGFyYW1ldGVycyA9IGZpbHRlclNlYXJjaFBhcmFtZXRlcnMoe1xuICAgICAgLi4udGhpcy5zdGFydGluZ1N0YXRlLFxuICAgICAgLi4udXJsU3RhdGVcbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWxpemUgdGhlIHN0YXRlIHdpdGhvdXQgY2FsbGluZyBfc2V0U3RhdGUsIGJlY2F1c2Ugd2UgZG9uJ3RcbiAgICAvLyB3YW50IHRvIHRyaWdnZXIgYW4gdXBkYXRlIGNhbGxiYWNrLCB3ZSdyZSBqdXN0IGluaXRpYWxpemluZyB0aGUgc3RhdGVcbiAgICAvLyB0byB0aGUgY29ycmVjdCBkZWZhdWx0IHZhbHVlcyBmb3IgdGhlIGluaXRpYWwgVUkgcmVuZGVyXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICAuLi5zZWFyY2hQYXJhbWV0ZXJzXG4gICAgfTtcblxuICAgIC8vIFdlJ2xsIHRyaWdnZXIgYW4gaW5pdGlhbCBzZWFyY2ggaWYgaW5pdGlhbCBwYXJhbWV0ZXJzIGNvbnRhaW5cbiAgICAvLyBhIHNlYXJjaCB0ZXJtIG9yIGZpbHRlcnMsIG9yIGlmIGFsd2F5c1NlYXJjaE9uSW5pdGlhbExvYWQgaXMgc2V0LlxuICAgIC8vIE90aGVyd2lzZSwgd2UnbGwganVzdCBzYXZlIHRoZWlyIHNlbGVjdGlvbnMgaW4gc3RhdGUgYXMgaW5pdGlhbCB2YWx1ZXMuXG4gICAgaWYgKFxuICAgICAgc2VhcmNoUGFyYW1ldGVycy5zZWFyY2hUZXJtIHx8XG4gICAgICBzZWFyY2hQYXJhbWV0ZXJzLmZpbHRlcnMubGVuZ3RoID4gMCB8fFxuICAgICAgdGhpcy5hbHdheXNTZWFyY2hPbkluaXRpYWxMb2FkXG4gICAgKSB7XG4gICAgICB0aGlzLl91cGRhdGVTZWFyY2hSZXN1bHRzKHNlYXJjaFBhcmFtZXRlcnMsIHsgcmVwbGFjZVVybDogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byB1cGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgYSBuZXcgYXV0b2NvbXBsZXRlIHNlYXJjaC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHNlYXJjaFRlcm1cbiAgICogQHBhcmFtIHtPYmplY3Q9fSBPYmplY3RcbiAgICogQHBhcmFtIHtib29sZWFufE9iamVjdH0gb3B0aW9ucy5hdXRvY29tcGxldGVSZXN1bHRzIC0gU2hvdWxkIGF1dG9jb21wbGV0ZSByZXN1bHRzXG4gICAqIEBwYXJhbSB7Ym9vbGVhbnxPYmplY3R9IG9wdGlvbnMuYXV0b2NvbXBsZXRlU3VnZ2VzdGlvbnMgLSBTaG91bGQgYXV0b2NvbXBsZXRlIHN1Z2dlc3Rpb25zXG4gICAqL1xuICBfdXBkYXRlQXV0b2NvbXBsZXRlID0gKFxuICAgIHNlYXJjaFRlcm0sXG4gICAgeyBhdXRvY29tcGxldGVSZXN1bHRzLCBhdXRvY29tcGxldGVTdWdnZXN0aW9ucyB9ID0ge31cbiAgKSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5hdXRvY29tcGxldGVSZXF1ZXN0U2VxdWVuY2VyLm5leHQoKTtcblxuICAgIGNvbnN0IHF1ZXJ5Q29uZmlnID0ge1xuICAgICAgLi4uKGF1dG9jb21wbGV0ZVJlc3VsdHMgJiYge1xuICAgICAgICByZXN1bHRzOiB0aGlzLmF1dG9jb21wbGV0ZVF1ZXJ5LnJlc3VsdHMgfHwge31cbiAgICAgIH0pLFxuICAgICAgLi4uKGF1dG9jb21wbGV0ZVN1Z2dlc3Rpb25zICYmIHtcbiAgICAgICAgc3VnZ2VzdGlvbnM6IHRoaXMuYXV0b2NvbXBsZXRlUXVlcnkuc3VnZ2VzdGlvbnMgfHwge31cbiAgICAgIH0pXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmV2ZW50c1xuICAgICAgLmF1dG9jb21wbGV0ZSh7IHNlYXJjaFRlcm0gfSwgcXVlcnlDb25maWcpXG4gICAgICAudGhlbihhdXRvY29tcGxldGVkID0+IHtcbiAgICAgICAgaWYgKHRoaXMuYXV0b2NvbXBsZXRlUmVxdWVzdFNlcXVlbmNlci5pc09sZFJlcXVlc3QocmVxdWVzdElkKSkgcmV0dXJuO1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZVJlcXVlc3RTZXF1ZW5jZXIuY29tcGxldGVkKHJlcXVlc3RJZCk7XG5cbiAgICAgICAgdGhpcy5fc2V0U3RhdGUoYXV0b2NvbXBsZXRlZCk7XG4gICAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byB1cGRhdGUgc3RhdGUgYW5kIHRyaWdnZXIgYSBuZXcgc2VhcmNoLlxuICAgKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBSZXF1ZXN0U3RhdGVcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IGN1cnJlbnRcbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHJlc3VsdHNQZXJQYWdlXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzZWFyY2hUZXJtXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3J0RGlyZWN0aW9uXG4gICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBzb3J0RmllbGRcbiAgICogQHByb3BlcnR5IHtBcnJheX0gc29ydExpc3RcbiAgICpcbiAgICogQHBhcmFtIHtSZXF1ZXN0U3RhdGV9IHNlYXJjaFBhcmFtZXRlcnMgLSBSZXF1ZXN0U3RhdGVcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBPYmplY3RcbiAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLnNraXBQdXNoVG9VcmwgLSBTa2lwIHB1c2hpbmcgdGhlIHVwZGF0ZWQgdG8gdGhlIFVSTFxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMucmVwbGFjZVVybCAtIFdoZW4gcHVzaGluZyBzdGF0ZSB0byB0aGUgVVJMLCB1c2UgaGlzdG9yeSAncmVwbGFjZSdcbiAgICogcmF0aGVyIHRoYW4gJ3B1c2gnIHRvIGF2b2lkIGFkZGluZyBhIG5ldyBoaXN0b3J5IGVudHJ5XG4gICAqL1xuICBfdXBkYXRlU2VhcmNoUmVzdWx0cyA9IChcbiAgICBzZWFyY2hQYXJhbWV0ZXJzLFxuICAgIHsgc2tpcFB1c2hUb1VybCA9IGZhbHNlLCByZXBsYWNlVXJsID0gZmFsc2UgfSA9IHt9XG4gICkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGN1cnJlbnQsXG4gICAgICBmaWx0ZXJzLFxuICAgICAgcmVzdWx0c1BlclBhZ2UsXG4gICAgICBzZWFyY2hUZXJtLFxuICAgICAgc29ydERpcmVjdGlvbixcbiAgICAgIHNvcnRGaWVsZCxcbiAgICAgIHNvcnRMaXN0XG4gICAgfSA9IHtcbiAgICAgIC4uLnRoaXMuc3RhdGUsXG4gICAgICAuLi5zZWFyY2hQYXJhbWV0ZXJzXG4gICAgfTtcblxuICAgIC8vIFN0YXRlIHVwZGF0ZXMgc2hvdWxkIGFsd2F5cyBiZSBhcHBsaWVkIGluIHRoZSBvcmRlciB0aGF0IHRoZXkgYXJlIG1hZGUuIFRoaXMgZnVuY3Rpb24sIF91cGRhdGVTZWFyY2hSZXN1bHRzLFxuICAgIC8vIG1ha2VzIHN0YXRlIHVwZGF0ZXMuXG4gICAgLy8gSW4gdGhlIGNhc2Ugd2hlcmUgYSBjYWxsIHRvIFwiX3VwZGF0ZVNlYXJjaFJlc3VsdHNcIiB3YXMgbWFkZSBhbmQgZGVsYXllZCBmb3IgWCBhbW91bnQgb2YgdGltZSB1c2luZ1xuICAgIC8vIGBkZWJvdW5jZU1hbmFnZXIucnVuV2l0aERlYm91bmNlYCwgYW5kIGEgc3Vic2VxdWVudCBjYWxsIGlzIG1hZGUgX3VwZGF0ZVNlYXJjaFJlc3VsdHMgYmVmb3JlIHRoYXQgZGVsYXkgZW5kcywgd2VcbiAgICAvLyB3YW50IHRvIG1ha2Ugc3VyZSB0aGF0IG91dHN0YW5kaW5nIGNhbGwgdG8gXCJfdXBkYXRlU2VhcmNoUmVzdWx0c1wiIGlzIGNhbmNlbGxlZCwgYXMgaXQgd291bGQgYXBwbHkgc3RhdGUgdXBkYXRlc1xuICAgIC8vIG91dCBvZiBvcmRlci5cbiAgICB0aGlzLmRlYm91bmNlTWFuYWdlci5jYW5jZWxCeU5hbWUoXCJfdXBkYXRlU2VhcmNoUmVzdWx0c1wiKTtcblxuICAgIHRoaXMuX3NldFN0YXRlKHtcbiAgICAgIGN1cnJlbnQsXG4gICAgICBlcnJvcjogXCJcIixcbiAgICAgIGZpbHRlcnMsXG4gICAgICByZXN1bHRzUGVyUGFnZSxcbiAgICAgIHNlYXJjaFRlcm0sXG4gICAgICBzb3J0RGlyZWN0aW9uLFxuICAgICAgc29ydEZpZWxkLFxuICAgICAgc29ydExpc3RcbiAgICB9KTtcblxuICAgIHRoaXMuX21ha2VTZWFyY2hSZXF1ZXN0KHtcbiAgICAgIHNraXBQdXNoVG9VcmwsXG4gICAgICByZXBsYWNlVXJsXG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIGlzIHNlcGFyYXRlZCBvdXQgZnJvbSBfdXBkYXRlU2VhcmNoUmVzdWx0cyBzbyB0aGF0IGl0XG4gICAqIGNhbiBiZSBkZWJvdW5jZWQuXG4gICAqXG4gICAqIEJ5IGRlYm91bmNpbmcgb3VyIEFQSSBjYWxscywgd2UgY2FuIGVmZmVjdGl2ZWx5IGFsbG93IGFjdGlvbiBjaGFpbmluZy5cbiAgICpcbiAgICogRm9yIEV4OlxuICAgKlxuICAgKiBJZiBhIHVzZXIgbmVlZHMgdG8gbWFrZSBtdWx0aXBsZSBmaWx0ZXIgdXBkYXRlcyBhdCBvbmNlLCB0aGV5IGNvdWxkXG4gICAqIGRvIHNvIGJ5IGNhbGxpbmcgYW4gYWN0aW9uIDMgdGltZXMgaW4gYSByb3c6XG4gICAqXG4gICAqICAgYWRkRmlsdGVyKFwic3RhdGVzXCIsIFwiQ2FsaWZvcm5pYVwiKTtcbiAgICogICBhZGRGaWx0ZXIoXCJzdGF0ZXNcIiwgXCJOZWJyYXNrYVwiKTtcbiAgICogICBhZGRGaWx0ZXIoXCJzdGF0ZXNcIiwgXCJQZW5uc3lsdmFuaWFcIik7XG4gICAqXG4gICAqIFdlIGRvbid0IHdhbnQgdG8gbWFrZSAzIHNlcGFyYXRlIEFQSSBjYWxscyBsaWtlIHRoYXQgaW4gcXVpY2sgc3VjY2Vzc2lvbixcbiAgICogc28gd2UgZGVib3VuY2UgdGhlIEFQSSBjYWxscy5cbiAgICpcbiAgICogQXBwbGljYXRpb24gc3RhdGUgdXBkYXRlcyBhcmUgcGVyZm9ybWVkIGluIF91cGRhdGVTZWFyY2hSZXN1bHRzLCBidXQgd2VcbiAgICogd2FpdCB0byBtYWtlIHRoZSBhY3R1YWwgQVBJIGNhbGxzIHVudGlsIGFsbCBhY3Rpb25zIGhhdmUgYmVlbiBjYWxsZWQuXG4gICAqXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5za2lwUHVzaFRvVXJsIC0gU2tpcCBwdXNoaW5nIHRoZSB1cGRhdGVkIHRvIHRoZSBVUkxcbiAgICogQHBhcmFtIHtib29sZWFufSBvcHRpb25zLnJlcGxhY2VVcmwgLSBXaGVuIHB1c2hpbmcgc3RhdGUgdG8gdGhlIFVSTCwgdXNlIGhpc3RvcnkgJ3JlcGxhY2UnXG4gICAqIHJhdGhlciB0aGFuICdwdXNoJyB0byBhdm9pZCBhZGRpbmcgYSBuZXcgaGlzdG9yeSBlbnRyeVxuICAgKi9cbiAgX21ha2VTZWFyY2hSZXF1ZXN0ID0gRGVib3VuY2VNYW5hZ2VyLmRlYm91bmNlKFxuICAgIDAsXG4gICAgKHsgc2tpcFB1c2hUb1VybCwgcmVwbGFjZVVybCB9KSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGN1cnJlbnQsXG4gICAgICAgIGZpbHRlcnMsXG4gICAgICAgIHJlc3VsdHNQZXJQYWdlLFxuICAgICAgICBzZWFyY2hUZXJtLFxuICAgICAgICBzb3J0RGlyZWN0aW9uLFxuICAgICAgICBzb3J0RmllbGQsXG4gICAgICAgIHNvcnRMaXN0XG4gICAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgICAgdGhpcy5fc2V0U3RhdGUoe1xuICAgICAgICBpc0xvYWRpbmc6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXF1ZXN0SWQgPSB0aGlzLnNlYXJjaFJlcXVlc3RTZXF1ZW5jZXIubmV4dCgpO1xuXG4gICAgICBjb25zdCB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgICBmaWx0ZXJzOiBzZWFyY2hRdWVyeUZpbHRlcnMsXG4gICAgICAgIGNvbmRpdGlvbmFsRmFjZXRzOiBjb25kaXRpb25hbEZhY2V0cyxcbiAgICAgICAgLi4ucmVzdE9mU2VhcmNoUXVlcnlcbiAgICAgIH0gPSB0aGlzLnNlYXJjaFF1ZXJ5O1xuXG4gICAgICBjb25zdCBxdWVyeUNvbmZpZyA9IHtcbiAgICAgICAgLi4ucmVzdE9mU2VhcmNoUXVlcnksXG4gICAgICAgIGZhY2V0czogcmVtb3ZlQ29uZGl0aW9uYWxGYWNldHMoXG4gICAgICAgICAgdGhpcy5zZWFyY2hRdWVyeS5mYWNldHMsXG4gICAgICAgICAgY29uZGl0aW9uYWxGYWNldHMsXG4gICAgICAgICAgZmlsdGVyc1xuICAgICAgICApXG4gICAgICB9O1xuICAgICAgY29uc3QgcmVxdWVzdFN0YXRlID0ge1xuICAgICAgICAuLi5maWx0ZXJTZWFyY2hQYXJhbWV0ZXJzKHRoaXMuc3RhdGUpLFxuICAgICAgICBmaWx0ZXJzOiBtZXJnZUZpbHRlcnMoZmlsdGVycywgdGhpcy5zZWFyY2hRdWVyeS5maWx0ZXJzKVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIHRoaXMuZXZlbnRzLnNlYXJjaChyZXF1ZXN0U3RhdGUsIHF1ZXJ5Q29uZmlnKS50aGVuKFxuICAgICAgICByZXN1bHRTdGF0ZSA9PiB7XG4gICAgICAgICAgaWYgKHRoaXMuc2VhcmNoUmVxdWVzdFNlcXVlbmNlci5pc09sZFJlcXVlc3QocmVxdWVzdElkKSkgcmV0dXJuO1xuICAgICAgICAgIHRoaXMuc2VhcmNoUmVxdWVzdFNlcXVlbmNlci5jb21wbGV0ZWQocmVxdWVzdElkKTtcblxuICAgICAgICAgIC8vIFJlc3VsdHMgcGFnaW5nIHN0YXJ0ICYgZW5kXG4gICAgICAgICAgY29uc3QgeyB0b3RhbFJlc3VsdHMgfSA9IHJlc3VsdFN0YXRlO1xuICAgICAgICAgIGNvbnN0IHN0YXJ0ID1cbiAgICAgICAgICAgIHRvdGFsUmVzdWx0cyA9PT0gMCA/IDAgOiAoY3VycmVudCAtIDEpICogcmVzdWx0c1BlclBhZ2UgKyAxO1xuICAgICAgICAgIGNvbnN0IGVuZCA9XG4gICAgICAgICAgICB0b3RhbFJlc3VsdHMgPD0gc3RhcnQgKyByZXN1bHRzUGVyUGFnZVxuICAgICAgICAgICAgICA/IHRvdGFsUmVzdWx0c1xuICAgICAgICAgICAgICA6IHN0YXJ0ICsgcmVzdWx0c1BlclBhZ2UgLSAxO1xuXG4gICAgICAgICAgdGhpcy5fc2V0U3RhdGUoe1xuICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgICAgIHJlc3VsdFNlYXJjaFRlcm06IHNlYXJjaFRlcm0sXG4gICAgICAgICAgICBwYWdpbmdTdGFydDogc3RhcnQsXG4gICAgICAgICAgICBwYWdpbmdFbmQ6IGVuZCxcbiAgICAgICAgICAgIC4uLnJlc3VsdFN0YXRlLFxuICAgICAgICAgICAgd2FzU2VhcmNoZWQ6IHRydWVcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmICh0aGlzLmhhc0ExMXlOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICBjb25zdCBtZXNzYWdlQXJncyA9IHsgc3RhcnQsIGVuZCwgdG90YWxSZXN1bHRzLCBzZWFyY2hUZXJtIH07XG4gICAgICAgICAgICB0aGlzLmFjdGlvbnMuYTExeU5vdGlmeShcInNlYXJjaFJlc3VsdHNcIiwgbWVzc2FnZUFyZ3MpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICghc2tpcFB1c2hUb1VybCAmJiB0aGlzLnRyYWNrVXJsU3RhdGUpIHtcbiAgICAgICAgICAgIC8vIFdlIGRlYm91bmNlIGhlcmUgc28gdGhhdCB3ZSBkb24ndCBnZXQgYSBsb3Qgb2YgaW50ZXJtZWRpYXJ5XG4gICAgICAgICAgICAvLyBVUkwgc3RhdGUgaWYgc29tZW9uZSBpcyB1cGRhdGluZyBhIFVJIHJlYWxseSBmYXN0LCBsaWtlIHR5cGluZ1xuICAgICAgICAgICAgLy8gaW4gYSBsaXZlIHNlYXJjaCBib3ggZm9yIGluc3RhbmNlLlxuICAgICAgICAgICAgdGhpcy5kZWJvdW5jZU1hbmFnZXIucnVuV2l0aERlYm91bmNlKFxuICAgICAgICAgICAgICB0aGlzLnVybFB1c2hEZWJvdW5jZUxlbmd0aCxcbiAgICAgICAgICAgICAgXCJwdXNoU3RhdGVUb1VSTFwiLFxuICAgICAgICAgICAgICB0aGlzLlVSTE1hbmFnZXIucHVzaFN0YXRlVG9VUkwuYmluZCh0aGlzLlVSTE1hbmFnZXIpLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY3VycmVudCxcbiAgICAgICAgICAgICAgICBmaWx0ZXJzLFxuICAgICAgICAgICAgICAgIHJlc3VsdHNQZXJQYWdlLFxuICAgICAgICAgICAgICAgIHNlYXJjaFRlcm0sXG4gICAgICAgICAgICAgICAgc29ydERpcmVjdGlvbixcbiAgICAgICAgICAgICAgICBzb3J0RmllbGQsXG4gICAgICAgICAgICAgICAgc29ydExpc3RcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgeyByZXBsYWNlVXJsIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5fc2V0U3RhdGUoe1xuICAgICAgICAgICAgZXJyb3I6IGBBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkOiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgKTtcblxuICBfc2V0U3RhdGUobmV3U3RhdGUpIHtcbiAgICBjb25zdCBzdGF0ZSA9IHsgLi4udGhpcy5zdGF0ZSwgLi4ubmV3U3RhdGUgfTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIGlmICh0aGlzLmRlYnVnKSBjb25zb2xlLmxvZyhcIlNlYXJjaCBVSTogU3RhdGUgVXBkYXRlXCIsIG5ld1N0YXRlLCBzdGF0ZSk7XG4gICAgdGhpcy5zdGF0ZSA9IHN0YXRlO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKHN1YnNjcmlwdGlvbiA9PiBzdWJzY3JpcHRpb24oc3RhdGUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEeW5hbWljYWxseSB1cGRhdGUgdGhlIHNlYXJjaFF1ZXJ5IGNvbmZpZ3VyYXRpb24gaW4gdGhpcyBkcml2ZXIuXG4gICAqIFRoaXMgd2lsbCBpc3N1ZSBhIG5ldyBxdWVyeSBhZnRlciBiZWluZyB1cGRhdGVkLlxuICAgKlxuICAgKiBAcGFyYW0gT2JqZWN0IHNlYXJjaFF1ZXJ5XG4gICAqL1xuICBzZXRTZWFyY2hRdWVyeShzZWFyY2hRdWVyeSkge1xuICAgIHRoaXMuc2VhcmNoUXVlcnkgPSBzZWFyY2hRdWVyeTtcbiAgICB0aGlzLl91cGRhdGVTZWFyY2hSZXN1bHRzKCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIE9iamVjdCBhdXRvY29tcGxldGVRdWVyeVxuICAgKi9cbiAgc2V0QXV0b2NvbXBsZXRlUXVlcnkoYXV0b2NvbXBsZXRlUXVlcnkpIHtcbiAgICB0aGlzLmF1dG9jb21wbGV0ZVF1ZXJ5ID0gYXV0b2NvbXBsZXRlUXVlcnk7XG4gIH1cblxuICAvKipcbiAgICogQW55IHRpbWUgc3RhdGUgaXMgdXBkYXRlZCBpbiB0aGlzIERyaXZlciwgdGhlIHByb3ZpZGVkIGNhbGxiYWNrXG4gICAqIHdpbGwgYmUgZXhlY3V0ZWQgd2l0aCB0aGUgdXBkYXRlZCBzdGF0ZS5cbiAgICpcbiAgICogQHBhcmFtIG9uU3RhdGVDaGFuZ2UgRnVuY3Rpb25cbiAgICovXG4gIHN1YnNjcmliZVRvU3RhdGVDaGFuZ2VzKG9uU3RhdGVDaGFuZ2UpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMucHVzaChvblN0YXRlQ2hhbmdlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcGFyYW0gb25TdGF0ZUNoYW5nZSBGdW5jdGlvblxuICAgKi9cbiAgdW5zdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyhvblN0YXRlQ2hhbmdlKSB7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zID0gdGhpcy5zdWJzY3JpcHRpb25zLmZpbHRlcihcbiAgICAgIHN1YiA9PiBzdWIgIT09IG9uU3RhdGVDaGFuZ2VcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhbGwgbGlzdGVuZXJzXG4gICAqL1xuICB0ZWFyRG93bigpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXTtcbiAgICB0aGlzLlVSTE1hbmFnZXIgJiYgdGhpcy5VUkxNYW5hZ2VyLnRlYXJEb3duKCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFsbCBhdmFpbGFibGUgYWNpdG9uc1xuICAgKlxuICAgKiBAcmV0dXJucyBPYmplY3QgQWxsIGFjdGlvbnNcbiAgICovXG4gIGdldEFjdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuYWN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBjdXJyZW50IHN0YXRlLiBUeXBpY2FsbHkgdXNlZCBvbiBhcHAgaW5pdGlhbGl6YXRpb24uIFN1YnNlcXVlbnRcbiAgICogc3RhdGUgdXBkYXRlcyBzaG91bGQgY29tZSB0aHJvdWdoIHN1YnNjcmlwdGlvbi5cbiAgICpcbiAgICogQHJldHVybnMgT2JqZWN0IEN1cnJlbnQgc3RhdGVcbiAgICovXG4gIGdldFN0YXRlKCkge1xuICAgIC8vIFdlIHJldHVybiBhIGNvcHkgb2Ygc3RhdGUgaGVyZSwgYmVjYXVzZSB3ZSB3YW50IHRvIGVuc3VyZSB0aGUgc3RhdGVcbiAgICAvLyBpbnNpZGUgb2YgdGhpcyBvYmplY3QgcmVtYWlucyBpbW11dGFibGUuXG4gICAgcmV0dXJuIHsgLi4udGhpcy5zdGF0ZSB9O1xuICB9XG59XG4iXX0=